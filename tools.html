

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>2. Ceilo toolbox (Auxiliary functions) &mdash; Boundary Layer Ceilometer Retrieval 1.0.1 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="_static/gallery.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="Boundary Layer Ceilometer Retrieval 1.0.1 documentation" href="index.html"/>
        <link rel="next" title="3. Data Frame toolbox (Auxiliary functions)" href="dftools.html"/>
        <link rel="prev" title="2. Algorithms for MLH Retrieval" href="secondary.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="master.html" class="icon icon-home"> Boundary Layer Ceilometer Retrieval
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="processing.html">1. Raw-file processing (.DAT)</a></li>
<li class="toctree-l1"><a class="reference internal" href="secondary.html">2. Algorithms for MLH Retrieval</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">2. Ceilo toolbox (Auxiliary functions)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#ceilo-tools-module">2.1. Ceilo tools module</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="dftools.html">3. Data Frame toolbox (Auxiliary functions)</a></li>
<li class="toctree-l1"><a class="reference internal" href="gallery.html">Gallery of Examples</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="master.html">Boundary Layer Ceilometer Retrieval</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="master.html">Docs</a> &raquo;</li>
        
      <li>2. Ceilo toolbox (Auxiliary functions)</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/tools.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="ceilo-toolbox-auxiliary-functions">
<h1>2. Ceilo toolbox (Auxiliary functions)<a class="headerlink" href="#ceilo-toolbox-auxiliary-functions" title="Permalink to this headline">¶</a></h1>
<div class="toctree-wrapper compound" id="auxtoc">
</div>
<span class="target" id="module-ceilotools"></span><div class="section" id="ceilo-tools-module">
<h2>2.1. Ceilo tools module<a class="headerlink" href="#ceilo-tools-module" title="Permalink to this headline">¶</a></h2>
<p>This is the main toolbox designed to aid main processsing by reading and writing to files and processing data.</p>
</div>
<dl class="function">
<dt id="ceilotools.algmlh">
<code class="descclassname">ceilotools.</code><code class="descname">algmlh</code><span class="sig-paren">(</span><em>allprf</em>, <em>method</em>, <em>mlh</em>, <em>i</em>, <em>z</em>, <em>tarr</em>, <em>t</em>, <em>uplim</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ceilotools.html#algmlh"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ceilotools.algmlh" title="Permalink to this definition">¶</a></dt>
<dd><blockquote>
<div>Algorithms used for Mixed-layer Height determination.This script computes the mlh through an iterative approach and calls the relevant method.</div></blockquote>
<p>A combined approach, named C2, due to the fact that it was the second version of a Combined algorithm uses both the gradient method and the wavelet method to find the boundary layer top. This was the algorithm used in <a class="reference internal" href="secondary.html#jlgf2018" id="id1">[GarciaFSB+18]</a>.</p>
<blockquote>
<div><p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><strong>allprf</strong>: <cite>np.nadarray</cite></dt>
<dd>backscattering matrix</dd>
</dl>
</div></blockquote>
<dl class="docutils">
<dt><strong>method</strong>: <cite>string</cite></dt>
<dd><blockquote class="first">
<div>String calling a MLH determination method, either of the following strings are accepted: ‘WT’, ‘Gradient’, ‘IPM’, ‘C2’.</div></blockquote>
<dl class="last docutils">
<dt><strong>tarr</strong> <span class="classifier-delimiter">:</span> <span class="classifier"><cite>np.array</cite></span></dt>
<dd>Time-array, usually decimal hours.</dd>
<dt><strong>mlh</strong> <span class="classifier-delimiter">:</span> <span class="classifier"><cite>numpy.nadarray</cite></span></dt>
<dd>Mixed-layer height array, usually len(mlh)=144.</dd>
</dl>
</dd>
<dt><strong>i</strong> <span class="classifier-delimiter">:</span> <span class="classifier"><cite>int</cite></span></dt>
<dd><blockquote class="first">
<div>Integer of current time-step. Ranging from 0-143.</div></blockquote>
<dl class="docutils">
<dt><strong>z</strong> <span class="classifier-delimiter">:</span> <span class="classifier"><cite>np.array</cite></span></dt>
<dd>Height-array usually length 500, start=10, end=5000, t_step=10 [m]</dd>
<dt><strong>t</strong> <span class="classifier-delimiter">:</span> <span class="classifier"><cite>numpy.narray-float</cite></span></dt>
<dd>Time float of this specific computation.</dd>
<dt><strong>uplim</strong> <span class="classifier-delimiter">:</span> <span class="classifier"><cite>string</cite></span></dt>
<dd>Upper-limit of maximum MLH possible.</dd>
</dl>
<table class="last docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">rtype:</th><td class="field-body">mlh: float</td>
</tr>
</tbody>
</table>
</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>See Also functions to estimate and write mlh</strong></p>
<p class="last"><a class="reference internal" href="#ceilotools.writemlh" title="ceilotools.writemlh"><code class="xref py py-meth docutils literal"><span class="pre">writemlh()</span></code></a>
<a class="reference internal" href="secondary.html#module-ipf" title="ipf"><code class="xref py py-meth docutils literal"><span class="pre">ipf()</span></code></a>
<a class="reference internal" href="secondary.html#module-wavelets" title="wavelets"><code class="xref py py-meth docutils literal"><span class="pre">wavelets()</span></code></a></p>
</div>
</dd></dl>

<dl class="function">
<dt id="ceilotools.writemlh">
<code class="descclassname">ceilotools.</code><code class="descname">writemlh</code><span class="sig-paren">(</span><em>outputfile</em>, <em>horas</em>, <em>mlhs</em>, <em>station</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ceilotools.html#writemlh"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ceilotools.writemlh" title="Permalink to this definition">¶</a></dt>
<dd><p>Write of mixed-layer file to txt file, using standard heading. For instance:</p>
<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><strong>outputfile</strong>: <cite>string</cite></dt>
<dd>Output filename. Usually a ‘txt’.</dd>
<dt><strong>horas</strong> <span class="classifier-delimiter">:</span> <span class="classifier"><cite>numpy.narray-float</cite></span></dt>
<dd>Time vector as hourly decimals. 0., 0.166, …, 23.83.</dd>
<dt><strong>mlhs</strong> <span class="classifier-delimiter">:</span> <span class="classifier"><cite>numpy.narray-float</cite></span></dt>
<dd>Mixed-layer heights vector.</dd>
<dt><a href="#id2"><span class="problematic" id="id3">**</span></a>station*: <cite>string</cite></dt>
<dd>Station string</dd>
</dl>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.7)">None</a></td>
</tr>
</tbody>
</table>
<p><em>See Also</em></p>
<p><span class="xref std std-ref">secondary</span>.</p>
</dd></dl>

<dl class="function">
<dt id="ceilotools.writematrix">
<code class="descclassname">ceilotools.</code><code class="descname">writematrix</code><span class="sig-paren">(</span><em>outputfile</em>, <em>matrix</em>, <em>zeta</em>, <em>hour_vec</em>, <em>station</em>, <em>date</em>, <em>runv</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ceilotools.html#writematrix"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ceilotools.writematrix" title="Permalink to this definition">¶</a></dt>
<dd><p>Write of backscattering matrix to txt file, using standard heading. For instance:</p>
<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><strong>outputfile</strong>: <cite>string</cite></dt>
<dd>Output filename. Usually a ‘txt’.</dd>
<dt><strong>matrix</strong>: <cite>numpy.nadarray</cite></dt>
<dd>Backscattering matrix mxn where m is the length of time vector, or number of decimal hours in the particular day and n is the length of height vector, usually 500 (10-5000 m every 10 m).</dd>
<dt><strong>hour_vec</strong> <span class="classifier-delimiter">:</span> <span class="classifier"><cite>numpy.narray-float</cite></span></dt>
<dd>Time vector as hourly decimals. 0., 0.166, …, 23.83.</dd>
<dt><strong>date</strong> <span class="classifier-delimiter">:</span> <span class="classifier"><cite>string</cite></span></dt>
<dd>Date of measurement (typically %Y%m%d)</dd>
<dt><a href="#id4"><span class="problematic" id="id5">**</span></a>station*: <cite>string</cite></dt>
<dd>Station string</dd>
</dl>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.7)">None</a></td>
</tr>
</tbody>
</table>
<p><em>See Also</em></p>
<p><span class="xref std std-ref">writemlh</span></p>
</dd></dl>

<dl class="function">
<dt id="ceilotools.cloudfilter">
<code class="descclassname">ceilotools.</code><code class="descname">cloudfilter</code><span class="sig-paren">(</span><em>allprf</em>, <em>tarr</em>, <em>z</em>, <em>datestring</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ceilotools.html#cloudfilter"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ceilotools.cloudfilter" title="Permalink to this definition">¶</a></dt>
<dd><p>This function computes the cloud filter equations described in [Teschke (2008),Garcia-Franco (2017), Garcia-Franco et.al. (2018)]</p>
<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><strong>allprf</strong>: <cite>np.nadarray</cite></dt>
<dd>backscattering matrix</dd>
<dt><strong>tarr</strong> <span class="classifier-delimiter">:</span> <span class="classifier"><cite>np.array</cite></span></dt>
<dd>Time-array, usually decimal hours.</dd>
<dt><strong>z</strong> <span class="classifier-delimiter">:</span> <span class="classifier"><cite>np.array</cite></span></dt>
<dd>Height-array usually length 500, start=10, end=5000, t_step=10 [m]</dd>
<dt><strong>datestring</strong> <span class="classifier-delimiter">:</span> <span class="classifier"><cite>string</cite></span></dt>
<dd>String for date, typically %Y%m%d, e.g., 20160305</dd>
</dl>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">datetimearray, flag vector: temps returns all datetimes where cloud or precipitation</td>
</tr>
</tbody>
</table>
<p>has been found, flag vector is a numpy array with the dimensions of tarr where clouds are depicted
as 1 and clear-sky conditions as 0.</p>
<p><strong>Statistical filter</strong></p>
<div class="math">
\[\beta_\sigma (z,t)=B(z,t)\sigma(t)\]</div>
<div class="math">
\[\mu=\frac{1}{N_zN_t}\sum_z\sum_t\beta_\sigma(z,t)\]</div>
<div class="math">
\[\sum=\frac{1}{N_zN_t-1}\sum_z\sum_t[\beta_\sigma(z,t)-\mu]^2.\]</div>
<div class="math">
\[B_N=\mu+3\sqrt{\sum}\]</div>
<ul class="simple">
<li><span class="math">\(B(z,t)\)</span> Backscattering matrix</li>
<li><span class="math">\(\sigma(t)\)</span> Variance over time $t$.</li>
<li><span class="math">\(\mu\)</span> Global mean of beta_sigma(z,t)</li>
<li><span class="math">\(\sum\)</span> Global variance of beta_sigma(z,t)</li>
<li><span class="math">\(z_{max}\)</span> Maximum integration level [m]</li>
<li><span class="math">\(B_N\)</span> Threshold for determining cloud or no cloud, function of both global mean and variance.</li>
</ul>
<p><cite>B_N</cite> defines the threshold value used for determining whether or not a profile at time <cite>t</cite> presents
cloud and precipiation or not. If B(z,t)&gt;B_N then cloud and precipitation are present. Else, clear-sky conditions
are considered.</p>
</dd></dl>

<dl class="function">
<dt id="ceilotools.runningMeanFast">
<code class="descclassname">ceilotools.</code><code class="descname">runningMeanFast</code><span class="sig-paren">(</span><em>x</em>, <em>N</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ceilotools.html#runningMeanFast"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ceilotools.runningMeanFast" title="Permalink to this definition">¶</a></dt>
<dd><blockquote>
<div><p>Running mean of array x over a window of size N.</p>
<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><strong>x</strong>: <cite>np.array</cite></dt>
<dd>Numpy array, usually 1D, to average over a moving or running mean.</dd>
<dt><strong>N</strong>: <cite>numpy.nadarray</cite></dt>
<dd>Size of moving average window.</dd>
</dl>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">rtype:</th><td class="field-body"><cite>np.array</cite> averaged with running mean.</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This script makes use of numpy.convolve.</p>
</div>
</dd></dl>

<dl class="function">
<dt id="ceilotools.writenumofprof">
<code class="descclassname">ceilotools.</code><code class="descname">writenumofprof</code><span class="sig-paren">(</span><em>outputfile</em>, <em>numofprof</em>, <em>t</em>, <em>estacion</em>, <em>date</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ceilotools.html#writenumofprof"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ceilotools.writenumofprof" title="Permalink to this definition">¶</a></dt>
<dd><blockquote>
<div><p>Write number of backscattering profiles used for every 10-min averaged window.</p>
<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><strong>outputfile</strong>: <cite>string</cite></dt>
<dd>Output filename. Usually a ‘txt’.</dd>
<dt><strong>numofprof</strong>: <cite>int</cite></dt>
<dd>Number of profiles used for average</dd>
<dt><strong>t</strong> <span class="classifier-delimiter">:</span> <span class="classifier"><cite>numpy.narray-float</cite></span></dt>
<dd>Time vector as hourly decimals. 0., 0.166, …, 23.83.</dd>
<dt><strong>date</strong> <span class="classifier-delimiter">:</span> <span class="classifier"><cite>string</cite></span></dt>
<dd>Date of measurement (typically %Y%m%d)</dd>
<dt><a href="#id6"><span class="problematic" id="id7">**</span></a>estacion*: <cite>string</cite></dt>
<dd>Station string</dd>
</dl>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">rtype:</th><td class="field-body">None</td>
</tr>
</tbody>
</table>
<p><em>See Also</em></p>
</div></blockquote>
<p><a class="reference internal" href="#ceilotools.writematrix" title="ceilotools.writematrix"><code class="xref py py-meth docutils literal"><span class="pre">writematrix()</span></code></a></p>
</dd></dl>

<dl class="function">
<dt id="ceilotools.readmatrixfile">
<code class="descclassname">ceilotools.</code><code class="descname">readmatrixfile</code><span class="sig-paren">(</span><em>filename</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ceilotools.html#readmatrixfile"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ceilotools.readmatrixfile" title="Permalink to this definition">¶</a></dt>
<dd><p>Write of backscattering matrix to txt file, using standard heading. For instance:</p>
<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><strong>filename</strong>: <cite>string</cite></dt>
<dd>Input filename. Usually a ‘txt’.</dd>
</dl>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">z,tarr,allprf height and time vector and backscattering matrix.</td>
</tr>
</tbody>
</table>
<p><em>See Also</em></p>
<p><a class="reference internal" href="#ceilotools.writemlh" title="ceilotools.writemlh"><code class="xref py py-meth docutils literal"><span class="pre">writemlh()</span></code></a></p>
</dd></dl>

<dl class="function">
<dt id="ceilotools.readmlh">
<code class="descclassname">ceilotools.</code><code class="descname">readmlh</code><span class="sig-paren">(</span><em>filename</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ceilotools.html#readmlh"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ceilotools.readmlh" title="Permalink to this definition">¶</a></dt>
<dd><p>Write of backscattering matrix to txt file, using standard heading. For instance:</p>
<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><strong>filename</strong>:<cite>string</cite></dt>
<dd>Input filename. Usually a ‘txt’.</dd>
</dl>
<p>:rtype:time-array, mlh-array:  time and MLH vector.</p>
<p><em>See Also</em></p>
<p><a class="reference internal" href="#ceilotools.writemlh" title="ceilotools.writemlh"><code class="xref py py-meth docutils literal"><span class="pre">writemlh()</span></code></a> , <a class="reference internal" href="#ceilotools.readmatrixfile" title="ceilotools.readmatrixfile"><code class="xref py py-meth docutils literal"><span class="pre">readmatrixfile()</span></code></a></p>
</dd></dl>

</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="dftools.html" class="btn btn-neutral float-right" title="3. Data Frame toolbox (Auxiliary functions)" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="secondary.html" class="btn btn-neutral" title="2. Algorithms for MLH Retrieval" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Garcia-Franco J. L..

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'1.0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>